---
layout: post
title: "pip-pop 源码"
date: 2017-10-12 12:19:21
---

# pip-pop 源码学习 #1

**lawyer up**

项目开始，使用MIT开源协议。

**dummy dir**

创建目录`pip_pop`

```shell
.
├── LICENSE
└── pip_pop
    └── __init__.py

1 directory, 2 files

```

[python dir中 `__init__.py`详解](http://www.cnblogs.com/Lands-ljk/p/5880483.html)

**READ IT**

添加说明文件

```shell
.
├── LICENSE
├── README.rst
└── pip_pop
    └── __init__.py

1 directory, 3 files

```

`README.rst`使用了rst格式而不是md格式。在PyPi中对rst的支持更好。

```Rst
pip-pop: tools for managing requirements files
==============================================

Working with lots of ``requirements.txt`` files can be a bit annoying.
Have no fear, **pip-pop** is here!

(work in progress)

Planned Commands
----------------

``$ pip-diff [--fresh | --stale] <reqfile> <reqfile> [output]``

Generates a diff between two given requirements files. Lists either stale or fresh packages.

``$ pip-flatten [--unsorted] <reqfile> [output]``

Takes a single requirements file, and expands it. Essential when working with included files.


Possible Future Commands
------------------------

- ``pip-where``
```

通过git记录可以看到大神们写代码的顺序和中间的变化。需要实现哪些功能和命令的格式在一开始就被规定好了。

`pip-diff`给定的两个需求文件，输出差异。列出需求文件中旧或新的包。

`pip-flatten`取一个需求文件，并将其扩展。扩展包括使用时候必不可少的项。

*不清楚是什么意思，可能列出是一些包的依赖。*

**docopt**

```shell
.
├── LICENSE
├── README.rst
├── pip_pop
│   └── __init__.py
└── requirements.txt

1 directory, 4 files
```

添加项目本需求文件

 docopt可以为app添加丰富的交互信息，包括参数和帮助以及描述信息。

[github:docopt](https://github.com/docopt/docopt)

[小赖的Python学习笔记 《docopt - 创建漂亮的命令行交互界面》](https://wp-lai.gitbooks.io/learn-python/content/0MOOC/docopt.html)

wsgiref 是 [PEP 333](http://legacy.python.org/dev/peps/pep-0333/) 定义的 wsgi 规范的范例实现。

[wsgiref_doc](http://peak.telecommunity.com/wsgiref_docs/)

[Cizixs blog  《wsgiref 源码解析》](http://cizixs.com/2014/11/09/dive-into-wsgiref)

进行到这里在Pycharm中建立虚拟环境安装需求文件

要注意docopt支持python2而不是python3

```Shell
pip install -r requirement.txt
```

```shell
Collecting docopt==0.6.2 (from -r requirements.txt (line 1))
Requirement already satisfied (use --upgrade to upgrade): wsgiref==0.1.2 in /System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7 (from -r requirements.txt (line 2))
Installing collected packages: docopt
Successfully installed docopt-0.6.2
```

**note about blacklisting plans**

```rst
Will potentially support blacklisting modules (wsgiref, distribute, setuptools)
```

readme.rst中添加了新的描述。可能支持黑名单模块

**Update README.rst**

说明文件内容结构变动

**exes**

```shell
.
├── LICENSE
├── README.rst
├── bin
│   ├── pip-diff
│   └── pip-flatten
├── pip_pop
│   └── __init__.py
├── requirements.txt
└── setup.py

2 directories, 7 files

```

添加了`setup.py`应该是配合`setuptools`使用

不清楚bin文件夹是干什么的。

[闫肃博客 《Python包管理工具setuptools详解》](http://yansu.org/2013/06/07/learn-python-setuptools-in-detail.html)

```Python
"""
pip-pop manages your requirements files.
"""
import sys
from setuptools import setup


setup(
    name='pip-pop',
    version='0.0.0',
    url='https://github.com/kennethreitz/pip-pop',
    license='MIT',
    author='Kenneth Reitz',
    author_email='me@kennethreitz.org',
    description=__doc__.strip('\n'),
    #packages=[],
    scripts=['bin/pip-diff', 'bin/pip-flatten'],
    #include_package_data=True,
    zip_safe=False,
    platforms='any',
    install_requires=['docopt'],
    classifiers=[
        # As from https://pypi.python.org/pypi?%3Aaction=list_classifiers
        #'Development Status :: 1 - Planning',
        #'Development Status :: 2 - Pre-Alpha',
        #'Development Status :: 3 - Alpha',
        'Development Status :: 4 - Beta',
        #'Development Status :: 5 - Production/Stable',
        #'Development Status :: 6 - Mature',
        #'Development Status :: 7 - Inactive',
        'Programming Language :: Python',
        'Programming Language :: Python :: 2',
        #'Programming Language :: Python :: 2.3',
        #'Programming Language :: Python :: 2.4',
        #'Programming Language :: Python :: 2.5',
        'Programming Language :: Python :: 2.6',
        'Programming Language :: Python :: 2.7',
        #'Programming Language :: Python :: 3',
        #'Programming Language :: Python :: 3.0',
        #'Programming Language :: Python :: 3.1',
        #'Programming Language :: Python :: 3.2',
        #'Programming Language :: Python :: 3.3',
        'Intended Audience :: Developers',
        'Intended Audience :: System Administrators',
        'License :: OSI Approved :: BSD License',
        'Operating System :: OS Independent',
        'Topic :: System :: Systems Administration',
    ]
)
```

**diffing works**

使用pycham打不开这个没有后缀的文件，还是动用了vim。

```python
  #!/usr/bin/env python
  # -*- coding: utf-8 -*-

  """Usage:
    pip-diff (--fresh | --stale) <reqfile1> <reqfile2>
    pip-diff (-h | --help)

  Options:
    -h --help     Show this screen.
    --fresh       List newly added packages.
    --stale       List removed packages.
  """
  import os
  from docopt import docopt
  from pkg_resources import parse_requirements
```

前面的字符串应该是给`docopt`使用提供帮助信息的

```python
  # TODO: ignore lines
  IGNORABLE_LINES = '#', '-r'
  VERSION_OPERATORS = ['==', '>=', '<=', '>', '<', ',']

  def split(s):
      for operator in VERSION_OPERATORS:
          s = s.replace(operator, '!')

      return s.split('!')
```

函数参数为文本，如果文本中出现列表中的字符，将字符替换成！然后根据！做切分。

*每次遍历只能修改一种符号，好蛋疼。不过感觉也没别的方法*

![Screen Shot 2017-10-12 at 3.38.50 PM](/Users/qducc/Desktop/Screen Shot 2017-10-12 at 3.38.50 PM.png)

关于super()

[漩涡鸣人博客 《python super()》](http://www.cnblogs.com/lovemo1314/archive/2011/05/03/2035005.html)

`super(classname, self).__init_()`调用该类父类的方法。

既先使用父类的初始化，再执行自己的初始化代码。

关于`__repr__`

[readthedocs 《python3-cookbook 8.1改变对象的字符串显示》](http://python3-cookbook.readthedocs.io/zh_CN/latest/c08/p01_change_string_representation_of_instances.html)

用于改变对象的显示形式，python解释器中直接输出对象的时候会根据`__repr__`显示，使用print的时候则会根据`__str__`的返回值显示。

在python中还有repr和str两个函数，repr并不转化对象，而str会将对象转化为str类型。repr是一种明确的表示形式，而str则可能改变对象结构如对float型数字的输出。

`os.path.exists`(*path*)

如果*path*引用一个存在的路径，返回`True`。如果path引用一个断开的符号链接，返回`False`。在某些平台上，尽管*path*物理存在，但是由于没有执行[`os.stat()`](http://python.usyiyi.cn/documents/python_278/library/os.html#os.stat)的权限，该函数也会返回`False`。

[os.path - 常用路径名操作](http://python.usyiyi.cn/translate/python_278/library/os.path.html)

使用return和raise抛出异常有什么区别？

在try中raise异常和在except中raise异常有什么区别？



## **Reference**

小赖的Python学习记笔记  docopt - 创建漂亮的命令行交互界面

From https://wp-lai.gitbooks.io/learn-python/content/0MOOC/docopt.html

Retrieved 2017-10-12 

— EOF —  